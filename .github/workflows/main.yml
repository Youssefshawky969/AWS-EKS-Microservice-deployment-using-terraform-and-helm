name: Cloud Native Platform Full CI/CD

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  terraform-platform:
    uses: ./.github/workflows/terraform-platform.yml
    secrets: inherit

  terraform-workload:
    needs: terraform-platform
    uses: ./.github/workflows/terraform-workload.yml
    secrets: inherit

  build-and-push:
    needs: terraform-workload
    uses: ./.github/workflows/build-push-ecr.yml
    secrets: inherit

  helm-deploy:
    needs: build-and-push
    uses: ./.github/workflows/helm-deploy.yml
    secrets: inherit
